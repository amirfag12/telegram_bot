import telebot
import sqlite3
import random

TOKEN = '7965728090:AAFoH7ZW3xf0MHCc5UzFvJAj3tOyM18xzsQ'
bot = telebot.TeleBot(TOKEN)

# ุงุฌุงุฏ ุงุชุตุงู ุจู ุฏุชุงุจุณ ู ุณุงุฎุช ุฌุฏูู ฺฏุฑููโูุง (ุงฺฏุฑ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ)
conn = sqlite3.connect('groups.db', check_same_thread=False)
cursor = conn.cursor()
cursor.execute('''
CREATE TABLE IF NOT EXISTS groups (
    chat_id INTEGER PRIMARY KEY,
    title TEXT,
    username TEXT
)
''')
conn.commit()

# ูุณุช ฺฉููุงุช ุจุงุฒ ุขุฎุฑู ุญุฑู
word_list = [
    'ุณุจ', 'ุจุฑฺฏ', 'ฺฏุฑุจู', 'ุงุณุจ', 'ุจุจุฑ', 'ุฑูุฏ', 'ุฏุฑุง', 'ุงุณุจฺฉ', 'ฺฉูู', 'ูุฑู',
    'ูุฑุฏ', 'ุฏุณุช', 'ุชุฎุช', 'ุทุฑุญ', 'ุญูุฒูู', 'ููุดู', 'ููุง', 'ุจุงุบ', 'ฺฏู', 'ูุจุฎูุฏ',
    'ุฏุงูู', 'ุฒูู', 'ูุงุฑูุฌ', 'ุฌูฺฏู', 'ูุจุงุณ', 'ุณุงุฑู', 'ุฑูฺฏ', 'ฺฏูุด', 'ุดุฑ', 'ุฑุดู',
    'ูุดุช', 'ุชุงุฑ', 'ุฑูุฏุฎุงูู', 'ููุงุด', 'ุงุฑ', 'ุฑุฆุณ', 'ุณุงุนุช', 'ุชููุฒูู', 'ูุงุฑฺฏู', 'ูุจ',
    'ุจุฑู', 'ููุฌุงู', 'ููุงุจ', 'ุจุงู', 'ูุฑุฏุงุจ', 'ุจุงุฏ', 'ุฏุฑฺู', 'ููุณุงู', 'ุงูฺฏูุฑ', 'ุฑุงู',
    'ูุงู', 'ููุงูพูุง', 'ุงูุฏุงุฒู', 'ุฒูุณุชุงู', 'ูุณู', 'ูุฒ', 'ุฒูุจูุฑ', 'ุฑุณุชูุฑุงู', 'ูุงู', 'ููฺฉ',
    'ฺฉุจุฑุช', 'ุชููู', 'ููุด', 'ุญูุงู', 'ููุฑ', 'ุฏู', 'ุจุงุฑุงู', 'ูุงู', 'ููุฒ', 'ุฒูุงู',
    'ููุงุฏ', 'ุฏูุง', 'ุขุณูุงู', 'ูุณุชู', 'ุณูฺฏ', 'ฺฏูุฌ', 'ุฌุงุฏู', 'ุฏุฑุงฺู', 'ูุฑูุฒ', 'ุฒุฑุฏ',
    'ุฏูุชุฑ', 'ุฑูฺฏู', 'ูุงููุง', 'ุชูุฑู', 'ฺฉููุณุชุงู', 'ุชููุง', 'ุจุงุฏ', 'ุงุฏ', 'ุฏูุจุฑ', 'ุฑูุฒ',
    'ุฒูุฒูู', 'ุงูุงุฑ', 'ุฑุงุฒ', 'ูพุฑ', 'ุจุงุฏุจุงุฏฺฉ', 'ุณูุฑุบ', 'ุฎุฑุณ', 'ฺฉูุงุบ', 'ููุด', 'ุดุฑู',
    'ฺฏูุณุชุงู', 'ุขูู', 'ุจููุดู', 'ูพุงู', 'ุณุชุงุฑู', 'ุฎูุฑุดุฏ', 'ูุงูุงู', 'ุฏุฑุงฺู', 'ฺฉุงุบุฐ', 'ุขุชุด',
    'ุจุงุบฺู', 'ฺฉููุณุงุฑ', 'ูู', 'ฺฏูุฏุงู', 'ุฏุดุช', 'ุชูุฏุฑ', 'ูุณู', 'ุจุงุฑุงู', 'ููุงุฑ', 'ูุฑุบ',
    'ุณูุณฺฉ', 'ุดุงูู', 'ุขูู', 'ูพูุฌุฑู', 'ูุฒุงู', 'ููู', 'ุจุฑูฺฉ', 'ฺฉูุด', 'ฺุชุฑ', 'ูุฑูุงุฑุฏ',
    'ุนูุงุจ', 'ุฒูุจู', 'ุดูุน', 'ูพุงูู', 'ฺฉูุฏ', 'ูพูุจู', 'ุตุฎุฑู', 'ุฏุงูู', 'ุฌูฺฏู', 'ุชูพู',
    'ููุฏู', 'ุณุงุญู', 'ุดฺฉููู', 'ุจูุฏุฑ', 'ููููุฑ', 'ุฎุฑูุณ', 'ฺฏูุฏูุฒ', 'ููุฌ', 'ุจุงุฑุงู', 'ุดุนูู',
    'ุณูุฒู', 'ูฺ', 'ฺฉุจูุชุฑ', 'ฺฉููุณุชุงู', 'ููุงุด', 'ุจุดู', 'ุฑูุฏุฎุงูู', 'ฺุดูู', 'ฺฏูุจุฑฺฏ', 'ุจููุท',
    'ุณุงู', 'ูุฏุงู', 'ูุฎู', 'ุฏุฑุฎุช', 'ุฎุงฺฉ', 'ฺุฑุงุบ', 'ูุงู', 'ุฎูุฑุดุฏ', 'ุณุชุงุฑู', 'ุงุจุฑ',
    'ุจุงุฏ', 'ุฑุนุฏ', 'ุจุฑู', 'ุฏุดุช', 'ุชููุงู', 'ุณุงุญู', 'ุฌุฒุฑู', 'ุฏุฑุง', 'ฺฉูู', 'ุฑูุฏ',
    'ุฏุฑุงฺู',
]

# ุฐุฎุฑู ูุถุนุช ุจุงุฒ ฺฉููุงุช ู ฺฉููุงุช ุงุณุชูุงุฏู ุดุฏู ุจุฑุง ูุฑ ฺุช
last_char = {}
used_words = {}

# ุฐุฎุฑู ุนุฏุฏ ุจุงุฒ ุญุฏุณ ุนุฏุฏ ุจุฑุง ูุฑ ฺุช
games = {}

# ูุณุช ุฌูฺฉโูุง
jokes = [
    "ูโุฏูู ฺุฑุง ูพุฑุณุชููุง ูพุฑูุงุฒ ูโฺฉููุ ฺูู ุงฺฏู ูพุงุฏู ุจุฑู ุฎุณุชู ูโุดู.",
    "ูโุฏูู ฺุฑุง ุณุฑ ููฺฉุฏูู ุณูุฑุงุฎ ุฏุงุฑูุ ุจุฑุง ฺฉู ููฺฉุง ุฎูู ูุดู.",
    "ูโุฏูู ฺุฑุง ูุงูโูุง ุฏุณุช ููุฏูุ ฺูู ุฏุณุชุงุดูู ุฎุณู.",
    "ูโุฏูู ุงฺฏู ู ูู ุจุฑู ุจุงูุง ุฏุฑุฎุช ฺ ูุดูุ ู ูู ุงุฒ ุฑู ุฒูู ฺฉู ูุดู.",
    "ูโุฏูู ููุช ูุงูโูุง ุบุฐุง ูโุฎูุฑู ฺ ูุดูุ ุณูุฑู ูุงู ูุงุฏ ุฌูุน ูโฺฉูู.",
    "ูโุฏูู ุงฺฏู ุฏูุชุง ุชุฑ ุขูู ุฏุนูุงุดูู ุจุดู ฺ ูุดูุ ูุฑู ูพุด ูพุฑุงูู ุชุง ูุดฺฉูุดูู ุญู ุจุดู.",
    "ูโุฏูู ููุช ู ููุด ุชุนุฌุจ ูโฺฉูู ฺ ูโฺฏูุ ูโฺฏู ูุงุง ุญุฌูุงุงุงู.",
    "ูโุฏูู ุงฺฏู ุชู ฺฉุงุณู ูุณ ุบุฐุง ุจุฎูุฑ ฺ ูุดูุ ูุณ ูุงุฑุงุญุช ูุดู.",
    "ูโุฏูู ุงฺฏู ุญูุงูุงุช ูุงุฏุฑ ุฑู ุดฺฉุงุฑ ฺฉูู ฺ ูุดูุ ูุงุฏุฑ ูุงุฑุงุญุช ูุดู.",
    "ูโุฏููู ูุฑุฎุง ุจู ุณุจโุฒูู ฺ ูโฺฏูุ ุณุจ ูุฑุฎ.",
    "ูโุฏูู ุงฺฏุฑ ุฏูุชุง ูู ุจุฑู ุฑู ุฏุฑุฎุช ฺ ูุดูุ ุฏุฑุฎุช ูโุดฺฉูู.",
    "ูโุฏููุฏ ุงฺฏู ฺฏูฺฏู ุจูุฑู ุจู ุจฺูโูุงุด ฺ ูโุฑุณูุ ฺฏูฺฏู ุงุฑุซ.",
    "ูโุฏูู ุงฺฏู ู ุฌุงุฏูฺฏุฑ ฺฉู ุณูุงุฑ ุฌุงุฑูุด ุดุฏู ู ุฏุงุฑู ู ูุณุฑ ุฑู ุท ูโฺฉููุ ุฎุณุชู ุดู ฺ ฺฉุงุฑ ูโฺฉููุ ุงุฒ ุฌุงุฑูุด ูพุงุฏู ูโุดูุ ุณูุงุฑ ุท ูโุดู ู ู ูุณุฑ ุฑู ุฌุงุฑู ูโฺฉูู.",
    "ู ุฑูุฒ ู ูุฑุฏ ุฑูุช ุจุงุบ ูุญุด ู ุฏุฏ ุฒุฑุงูู ุฏุงุฑู ููุชุจุงู ุจุงุฒ ูโฺฉูู!",
    "ุงฺฏุฑ ูพูู ุชู ุจุงุบฺู ุฑุดุฏ ูโฺฉุฑุฏุ ููู ฺฉุดุงูุฑุฒ ูโุดุฏู!",
    "ฺุฑุง ุฏุงูุดุฌููุง ููุดู ุฏุฑ ูโุฑุณูุ ฺูู ฺฉูุงุณ ุขุฎุฑุดููู!",
    "ู ูุฑุบ ุงููุฏ ุชู ฺฉูุงุณ ุฑุงุถุ ุงุณุชุงุฏ ฺฏูุช: ฺุฑุง ุฏุฑ ุงููุฏุ ูุฑุบ ฺฏูุช: ฺฏุฑ ฺฉุฑุฏู ุชู ุชุฎู ูุฑุบ!",
    "ฺุฑุง ููุฑุจุงุบู ููุดู ุฎูุดุญุงููุ ฺูู ูฺ ููุช ฺฉุงุฑ ููโฺฉูู!",
    "ู ุฑูุฒ ู ุจฺู ุจู ุจุงุจุงุด ฺฏูุช: ุจุงุจุง ูู ู ุณููพุฑ ููุฑูุงููุ ุจุงุจุง ฺฏูุช: ุฎูุจุ ุจุดู ุณุฑ ฺฉุงุฑุช!",
    "ฺุฑุง ูุงู ููุดู ุฎุณูุ ฺูู ุชู ุขุจ ุฒูุฏฺฏ ูโฺฉูู!",
    "ูโุฏููุฏ ฺุฑุง ููุฌ ูุงุฑูุฌูุ ฺูู ุจูุด ูุงุฏ.",
    "ูโุฏููุฏ ฺุฑุง ูุงุดู ุขุฑุฏ ุฑุง ููโุดูุฑูุ ฺูู ุจูุดูู ุขุจ ุจุฎูุฑู ุฎูุฑ ูโุดู.",
    "ูโุฏููุฏ ุงฺฏู ุฒู ูุงุถู ฺฏููุด ฺฏุฑ ฺฉูู ฺ ูโฺฏูุ ูโฺฏู ูุงุถูุงุจ.",
    "ูโุฏููุฏ ฺุฑุง ุงูฺฉุชุฑููโูุง ุณูุงุฑ ฺุฑุฎ ู ููฺฉ ููุดูุ ฺูู ุจุงุฑุฏุงุฑู ุจุฑุงุดูู ุฎูุจ ูุณุช.",
    "ูโุฏููุฏ ฺุฑุง ุฎฺุงู ุจุฑู ุฏุงุฑูุ ฺูู ุขูุชู ูุฏุงุฑู.",
    "ูโุฏูู ฺุฑุง ุงุณฺฉูุช ุงุฒ ุณุงุฎุชูุงู ููโูพุฑู ูพุงูุ ฺูู ุฌฺฏุฑ ูุฏุงุฑู.",
    "ูโุฏููู ฺุฑุง ูุงฺฉโูพุดุชโูุง ููุงุฒ ููโุฎูููุ ฺูู ูุงฺฉ ุฏุงุฑู.",
    "ูโุฏููู ฺุฑุง ูพูฺฏูุฆูโูุง ุณูุงุฏ ูุฏุงุฑูุ ฺูู ููุดู ุจุฑู ูุงุฏุ ูุฏุงุฑุณุดูู ุชุนุทูู!",
    "ูโุฏููู ฺุฑุง ููโูุง ุงุฒ ุณุฑุจุงุฒ ูุนุงููุฏุ ฺูู ฺฉู ูพุงุดูู ุตุงูู.",
    "ู ุฑูุฒ ู ูฺฏุณ ูุฑุถ ูโุดูุ ูุงูุงูุด ูุงุณุด ุงุณูุงู ุฏุฑุณุช ูโฺฉูู.",
    "ู ุฑูุฒ ู ุณุฑู ุจุง ู ูพุชุฒุงูู ุฏุนูุงุด ูุดู ูฺฏู ุญู ุณุฑู ูฺฏุฑูู ูุฎูุฑุฏูุช.",
    "ูโุฏููู ููุช ุณฺฏุงุฑุง ุฎูุดุญุงู ูโุดู ฺ ูโุดูุ ุชูุชููุดูู ุนุฑูุณ ูโุดู.",
    "ู ุฑูุฒ ฺฉ ุฎูุฏุดู ูโูุงูููุฏ ุจู ุณูพุฑ ูุงุดูุ ุจูุด ฺฏูุชู ฺฺฉุงุฑ ูโฺฉูุ ฺฏูุช ุฏุงุฑู ุฑูุฒูู ุณูพุฑ ูโฺฉูู.",
    "ู ุฑูุฒ ูู ูุฑู ุจุงูุง ุฏุฑุฎุช ฺูุงุฑุ ุจูุด ูฺฏู ุฏุงุฑ ฺ ฺฉุงุฑ ูโฺฉูุ ูฺฏู ุฏุงุฑู ุชูุช ูโุฎูุฑู. ูฺฏู ุงูฺฉู ุฏุฑุฎุช ฺูุงุฑูุ ูฺฏู ุชูุช ุชู ุฌุจูู.",
    "ูโุฏููู ุงฺฏู ูุงฺฉุงุฑููโูุง ูุงุท ูพุงุท ุจุฎูุฑู ฺ ูุดูุ ููุฏู ูฺฉูู!",
    "ูโุฏููู ฺฉุชุฑโูุง ุณุฑุจุงุฒ ููุช ูุฑูุงูุฏุดูู ุตุฏุงุดูู ูฺฉูู ฺ ูฺฏูุ ูฺฏู ุจูู ุจู ุฌูุดู!",
    "ูโุฏููู ูููโูุง ูููุน ุชููุฏ ุจู ููุฏฺฏู ฺ ฺฉุงุฏู ูุฏูุ ุขูุงฺฉุงุฏู!",
    "ูโุฏููู ูุงูโูุง ููุช ุจุงูู ุฏุนูุงุดูู ูุดู ฺฉุฌุง ูุฑูุ ูุฑู ุฌุงุฌุฑูุฏ!",
    "ูโุฏููู ุงฺฏู ุณูุณุณู ุจุฒุงุฑ ุฑู ุขุชุด ฺ ูุดูุ ูโุณูุณู!"
]

# --- ุฐุฎุฑู ฺฏุฑููโูุง ุฏุฑ ุฏุชุงุจุณ ููุช ุฑุจุงุช ุจู ฺฏุฑูู ุงุถุงูู ูโุดูุฏ ---
@bot.my_chat_member_handler()
def handle_my_chat_member(message):
    chat = message.chat
    new_status = message.new_chat_member.status

    if new_status in ['member', 'administrator']:
        chat_id = chat.id
        title = getattr(chat, 'title', None)
        username = getattr(chat, 'username', None)

        cursor.execute('INSERT OR IGNORE INTO groups (chat_id, title, username) VALUES (?, ?, ?)',
                       (chat_id, title, username))
        conn.commit()
        print(f"ุฑุจุงุช ุจู ฺฏุฑูู '{title}' ุจุง ุดูุงุณู {chat_id} ุงุถุงูู ุดุฏ.")

# --- ุฏุณุชูุฑ ููุงุด ฺฏุฑููโูุง ุฐุฎุฑู ุดุฏู ---
@bot.message_handler(commands=['showgroups'])
def show_groups(message):
    cursor.execute('SELECT chat_id, title, username FROM groups')
    groups = cursor.fetchall()

    if not groups:
        bot.reply_to(message, 'ูฺ ฺฏุฑูู ุฐุฎุฑู ูุดุฏู.')
        return

    text = "ูุณุช ฺฏุฑููโูุง ุฐุฎุฑูโุดุฏู:\n\n"
    for chat_id, title, username in groups:
        if username:
            link = f"https://t.me/{username}"
        else:
            link = 'ููฺฉ ููุฌูุฏ ูุณุช'
        text += f"ูุงู: {title or 'ูุงูุดุฎุต'}\nุขุฏ: {chat_id}\nููฺฉ: {link}\n\n"

    bot.reply_to(message, text)

# --- ุดุฑูุน ุจุงุฒ ุขุฎุฑู ุญุฑู ---
@bot.message_handler(commands=['wordgame'])
def start_wordgame(message):
    chat_id = message.chat.id
    last_char[chat_id] = None
    used_words[chat_id] = set()
    bot.send_message(chat_id, "ุจุงุฒ ุขุฎุฑู ุญุฑู ุดุฑูุน ุดุฏ! ุดูุง ุงูู ุดุฑูุน ฺฉูุฏ. ูุทูุง ฺฉ ฺฉููู ุจูุฑุณุชุฏ.")

# --- ูพุงุณุฎ ุจู ฺฉููุงุช ุจุงุฒ ุขุฎุฑู ุญุฑู ---
@bot.message_handler(func=lambda m: m.chat.id in last_char)
def play_wordgame(message):
    chat_id = message.chat.id
    user_word = message.text.strip()

    # ฺฺฉ ฺฉุฑุฏู ุงฺฏุฑ ฺฉุงุฑุจุฑ ุงููู ฺฉููู ุฑุง ูุฑุณุชุงุฏู
    if last_char[chat_id] is None:
        if user_word not in word_list:
            bot.reply_to(message, "ุงู ฺฉููู ุฏุฑ ูุณุช ูุง ูุณุช. ูุทูุง ฺฉ ฺฉููู ูุนุชุจุฑ ุจูุฑุณุชุฏ.")
            return
        last_char[chat_id] = user_word[-1]
        used_words[chat_id].add(user_word)
        bot.reply_to(message, f"ฺฉููู ุซุจุช ุดุฏ. ููุจุช ูู...")

        # ุฑุจุงุช ฺฉูููโุง ูพุฏุง ูโฺฉูุฏ ฺฉู ุจุง ุญุฑู ุขุฎุฑ ฺฉููู ุดูุง ุดุฑูุน ุดูุฏ ู ุงุณุชูุงุฏู ูุดุฏู ุจุงุดุฏ
        bot_word = None
        for w in word_list:
            if w[0] == last_char[chat_id] and w not in used_words[chat_id]:
                bot_word = w
                break

        if bot_word:
            used_words[chat_id].add(bot_word)
            last_char[chat_id] = bot_word[-1]
            bot.send_message(chat_id, f"{bot_word}\nููุจุช ุดูุงุ ฺฉููู ุจุง ุญุฑู '{last_char[chat_id]}'")
        else:
            bot.send_message(chat_id, "ูู ุฏฺฏู ฺฉูููโุง ูพุฏุง ูฺฉุฑุฏู! ุดูุง ุจุฑูุฏูโุงุฏ! ๐")
            # ุจุงุฒ ุชูุงู ุดุฏ
            del last_char[chat_id]
            del used_words[chat_id]
    else:
        # ฺฺฉ ฺฉุฑุฏู ุดุฑูุน ุญุฑู
        if user_word[0] != last_char[chat_id]:
            bot.reply_to(message, f"ฺฉููู ุจุงุฏ ุจุง ุญุฑู '{last_char[chat_id]}' ุดุฑูุน ุดูุฏ.")
            return
        if user_word in used_words[chat_id]:
            bot.reply_to(message, "ุงู ฺฉููู ูุจูุง ุงุณุชูุงุฏู ุดุฏู ุงุณุช.")
            return
        if user_word not in word_list:
            bot.reply_to(message, "ุงู ฺฉููู ุฏุฑ ูุณุช ูุง ูุณุช.")
            return

        used_words[chat_id].add(user_word)
        last_char[chat_id] = user_word[-1]
        bot.reply_to(message, "ฺฉููู ุซุจุช ุดุฏ. ููุจุช ูู...")

        bot_word = None
        for w in word_list:
            if w[0] == last_char[chat_id] and w not in used_words[chat_id]:
                bot_word = w
                break

        if bot_word:
            used_words[chat_id].add(bot_word)
            last_char[chat_id] = bot_word[-1]
            bot.send_message(chat_id, f"{bot_word}\nููุจุช ุดูุงุ ฺฉููู ุจุง ุญุฑู '{last_char[chat_id]}'")
        else:
            bot.send_message(chat_id, "ูู ุฏฺฏู ฺฉูููโุง ูพุฏุง ูฺฉุฑุฏู! ุดูุง ุจุฑูุฏูโุงุฏ! ๐")
            del last_char[chat_id]
            del used_words[chat_id]

# --- ุดุฑูุน ุจุงุฒ ุญุฏุณ ุนุฏุฏ ---
@bot.message_handler(commands=['guess'])
def start_guess(message):
    chat_id = message.chat.id
    number = random.randint(1, 100)
    games[chat_id] = number
    bot.send_message(chat_id, "ุจุงุฒ ุญุฏุณ ุนุฏุฏ ุดุฑูุน ุดุฏ! ูู ุนุฏุฏ ุจู 1 ุชุง 100 ุงูุชุฎุงุจ ฺฉุฑุฏู. ุญุฏุณ ุจุฒูุฏ.")

# --- ุญุฏุณ ุฒุฏู ุนุฏุฏ ---
@bot.message_handler(func=lambda m: m.chat.id in games)
def guess_number(message):
    chat_id = message.chat.id
    try:
        guess = int(message.text.strip())
    except ValueError:
        bot.reply_to(message, "ูุทูุง ฺฉ ุนุฏุฏ ูุงุฑุฏ ฺฉูุฏ.")
        return

    number = games[chat_id]

    if guess == number:
        bot.send_message(chat_id, f"ุชุจุฑฺฉ! ุนุฏุฏ ุฏุฑุณุช {number} ุจูุฏ. ุจุงุฒ ุชูุงู ุดุฏ.")
        del games[chat_id]
    elif guess < number:
        bot.send_message(chat_id, "ุนุฏุฏ ุจุฒุฑฺฏุชุฑูุ ุฏูุจุงุฑู ุญุฏุณ ุจุฒูุฏ.")
    else:
        bot.send_message(chat_id, "ุนุฏุฏ ฺฉูฺฺฉุชุฑูุ ุฏูุจุงุฑู ุญุฏุณ ุจุฒูุฏ.")

# --- ุงุฑุณุงู ุฌูฺฉ ---
@bot.message_handler(commands=['joke'])
def send_joke(message):
    joke = random.choice(jokes)
    bot.send_message(message.chat.id, joke)

# --- ุดุฑูุน ุฑุจุงุช ---
print("ุฑุจุงุช ุดุฑูุน ุจู ฺฉุงุฑ ฺฉุฑุฏ.")
bot.infinity_polling()
